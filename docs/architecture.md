# Архитектура Trading Signal Bridge

## Общая схема системы

Trading Signal Bridge представляет собой распределенную систему для автоматизированной торговли, состоящую из четырех основных компонентов:

### 1. MQL5 (MetaTrader 5)
- **Назначение**: Исполнение торговых операций и управление ордерами
- **Функции**:
  - Получение сигналов из внешних источников
  - Исполнение торговых операций (Buy/Sell)
  - Экспорт данных в MySQL
  - Управление рисками и позициями

### 2. MySQL (База данных)
- **Назначение**: Центральное хранилище данных
- **Функции**:
  - Хранение истории ордеров и сигналов
  - Обеспечение доступа для аналитики
  - Логирование системных событий
  - Хранение настроек стратегий

### 3. C# (Аналитическая система)
- **Назначение**: Анализ данных и генерация торговых сигналов
- **Функции**:
  - Подключение к базе MySQL и извлечение истории
  - Реализация алгоритмов анализа
  - Генерация торговых сигналов
  - Взаимодействие с MQL5 через DLL

### 4. DLL (Динамическая библиотека)
- **Назначение**: Мост между C# и MQL5
- **Функции**:
  - Экспорт функций для вызова из MQL5
  - Обеспечение межпроцессного взаимодействия
  - Сериализация/десериализация данных

## Поток данных

```
C# Анализатор → DLL → MQL5 → MySQL
     ↑                                    ↓
     ←─────────── Обратная связь ──────────
```

### Детальное описание потока:

1. **Генерация сигнала**: C# анализатор анализирует данные из MySQL и генерирует торговый сигнал
2. **Передача через DLL**: Сигнал передается в MQL5 через вызов функции DLL
3. **Исполнение**: MQL5 получает сигнал и исполняет торговую операцию
4. **Запись результата**: Результат сделки записывается в таблицу orders в MySQL
5. **Обратная связь**: C# анализатор получает обновленные данные для дальнейшего анализа

## Технологический стек

### MQL5
- **Язык**: MQL5 (MetaQuotes Language 5)
- **API**: MetaTrader 5 API
- **Функции**: Торговые операции, управление ордерами

### MySQL
- **Версия**: 8.0+
- **Функции**: Хранение данных, индексация, представления
- **Связи**: Внешние ключи для целостности данных

### C#
- **Фреймворк**: .NET 6.0
- **Библиотеки**: 
  - MySql.Data для работы с БД
  - Newtonsoft.Json для сериализации
  - Serilog для логирования

### C++ (DLL)
- **Компилятор**: Visual Studio 2019+
- **Стандарт**: C++17
- **Экспорт**: __declspec(dllexport) для Windows

## Пример взаимодействия

### Сигнал на покупку EUR/USD:

1. **C# анализатор**:
   ```csharp
   // Анализ данных и генерация сигнала
   var signal = new TradingSignal
   {
       Symbol = "EURUSD",
       Action = "BUY",
       Price = 1.0850,
       Volume = 0.1,
       Confidence = 0.85
   };
   
   // Отправка сигнала через DLL
   TradingBridge.SendSignal(signal);
   ```

2. **DLL мост**:
   ```cpp
   // Экспорт функции для MQL5
   extern "C" __declspec(dllexport) bool SendSignal(const char* symbol, 
                                                   double price, 
                                                   double volume, 
                                                   double confidence);
   ```

3. **MQL5 эксперт**:
   ```mql5
   // Получение сигнала и исполнение
   if (signal_received) {
       bool result = OpenBuyOrder(symbol, volume, price, sl, tp);
       if (result) {
           // Запись в MySQL
           LogOrder(symbol, "BUY", price, volume);
       }
   }
   ```

4. **MySQL**:
   ```sql
   -- Запись результата сделки
   INSERT INTO orders (symbol, type, price, volume, status) 
   VALUES ('EURUSD', 'BUY', 1.0850, 0.1, 'OPEN');
   ```

## Безопасность и надежность

### Меры безопасности:
- Валидация всех входных данных
- Логирование всех операций
- Проверка прав доступа к базе данных
- Резервное копирование данных

### Обработка ошибок:
- Try-catch блоки в C#
- Проверка возвращаемых значений в MQL5
- Транзакции в MySQL
- Graceful degradation при сбоях

## Масштабируемость

### Горизонтальное масштабирование:
- Множественные экземпляры C# анализатора
- Репликация MySQL
- Балансировка нагрузки

### Вертикальное масштабирование:
- Оптимизация запросов к БД
- Кэширование данных
- Параллельная обработка сигналов

## Мониторинг и логирование

### Система логирования:
- Структурированные логи в MySQL
- Файловые логи для отладки
- Алерты при критических ошибках

### Метрики производительности:
- Время отклика системы
- Количество обработанных сигналов
- Прибыльность торговых операций
- Использование ресурсов 